GET /_cat/indices/ml_toolbox_raw_data

GET ml_toolbox_raw_data/_search?size=1

GET _sql?format=txt
{
  "query": """
SELECT CONCAT(uniqueID, CONCAT('-', MeasurementData.MeasurementParameter.StudID.value)) as StudExtension, count(*), min(timestamp), max(timestamp), avg(WeldVoltageActual)
FROM ml_toolbox_raw_data
GROUP BY 1
ORDER BY 2 desc
LIMIT 10
  """
}


GET _sql/translate
{
  "query": """
SELECT MeasurementData.MeasurementParameter.StudID.value as StudExtension, count(*), min(timestamp), max(timestamp), avg(WeldVoltageActual)
FROM ml_toolbox_raw_data
WHERE uniqueID = 'h902-080tsb101-kf130.m050g9sub63sps2.1.1' and
      FaultCode = '0'
GROUP BY 1
ORDER BY 2 desc
LIMIT 10
  """
}



GET ml_toolbox_raw_data/_search
{
  "query": {
    "bool": {
      "filter": [
        {
          "term": {
            "StudID.keyword": "610619"
          }
        },
        {
          "term": {
            "uniqueID.keyword": "h902-070tsb101-kf130.m050g9sub63sps2.1.1"
          }
        },
        {
          "term": {
            "MeasurementData.MeasurementParameter.StudID.value.keyword": "610619_213_1_1_1_1_1_1"
          }
        }
      ],
      "must_not": [
        {
          "term": {
            "CarbodyID.keyword": 0
          }
        }
      ]
    }
  },
  "_source": [
    "location",
    "series",
    "line",
    "plant",
    "station",
    "robot",
    "controller",
    "tool",
    "StudID",
    "MeasurementData.MeasurementParameter.StudID.value",
    "CarbodyID",
    "SeriesTypeDescription",
    "SeriesLRHandDriveDescription",
    "SeriesVariantDescription",
    "SeriesModelDescription",
    "uniqueID",
    "toolType",
    "studType",
    "studSize",
    "DeviceGeneration",
    "WeldToolType",
    "WeldCurrentActualPositive",
    "WeldCurrentReferencePositive",
    "WeldCurrentUpperLimit",
    "WeldCurrentLowerLimit",
    "WeldTimeActual",
    "WeldTimeReference",
    "WeldTimeUpperLimit",
    "WeldTimeLowerLimit",
    "WeldVoltageActual",
    "WeldVoltageUpperLimit",
    "WeldVoltageLowerLimit",
    "WeldVoltagePeakActual",
    "WeldVoltageDropActual",
    "WeldEnergyActual",
    "WeldEnergyUpperLimit",
    "WeldEnergyLowerLimit",
    "PilotVoltageActual",
    "PilotVoltageLowerLimit",
    "PilotVoltageUpperLimit",
    "LMLiftHeightActual",
    "LMLiftHeightReference",
    "LMLiftHeightUpperLimit",
    "LMLiftHeightLowerLimit",
    "LMPenetrationActual",
    "LMPenetrationReference",
    "LMPenetrationUpperLimit",
    "LMPenetrationLowerLimit",
    "DropTimeActual",
    "DropTimeReference",
    "StickoutActual",
    "CleanTimeActual",
    "fingerprint",
    "FeederNo",
    "OutletNo",
    "ToolNo",
    "WIP",
    "FaultCode",
    "timestamp",
    "mqtt.topic.element.typ",
    "mqtt.topic.element.typ_version",
    "MeasurementData.MeasurementParameter.Devicetype.value",
    "MeasurementData.MeasurementParameter.InternalStudID.value",
    "MeasurementData.MeasurementParameter.SystemTotalWelds.value",
    "MeasurementData.MeasurementParameter.OutletTotalWelds.value",
    "MeasurementData.MeasurementParameter.OutletTotalWOPs.value",
    "MeasurementData.MeasurementParameter.WeldToolTotalWelds.value",
    "MeasurementData.MeasurementParameter.ProgTotalWelds.value",
    "MeasurementData.MeasurementParameter.StudReloadCountMissingStud.value",
    "MeasurementData.MeasurementParameter.StudReloadCountNoSOW.value",
    "MeasurementData.MeasurementParameter.WeldProcess.value",
    "MeasurementData.MeasurementParameter.PilotCurrentActual.value",
    "MeasurementData.MeasurementParameter.PilotTimeActual.value",
    "MeasurementData.MeasurementParameter.WeldVoltagePeakReference.value",
    "MeasurementData.MeasurementParameter.WeldVoltageDropReference.value",
    "MeasurementData.MeasurementParameter.WeldCurrentReferenceNegative.value",
    "MeasurementData.MeasurementParameter.WeldCurrentActualNegative.value",
    "MeasurementData.MeasurementParameter.LMPositionActual.value",
    "MeasurementData.MeasurementParameter.LiftFinishedMode.value",
    "MeasurementData.MeasurementParameter.StickoutReference.value",
    "MeasurementData.MeasurementParameter.StickoutLowerLimit.value",
    "MeasurementData.MeasurementParameter.StickoutUpperLimit.value",
    "MeasurementData.MeasurementParameter.TRRotationAngleActual.value",
    "MeasurementData.MeasurementParameter.ProtectiveGasPreFlowActive.value",
    "MeasurementData.MeasurementParameter.ProtectiveGasFlowDuringWeldprocessActive.value",
    "MeasurementData.MeasurementParameter.ProtectiveGasPostFlowActive.value",
    "MeasurementData.MeasurementParameter.CleanCurrentActual.value",
    "MeasurementData.MeasurementParameter.CleanSuccessful.value",
    "MeasurementData.MeasurementParameter.CleanVoltageActual.value",
    "MeasurementData.MeasurementParameter.CleanVoltageLowerLimit.value",
    "MeasurementData.MeasurementParameter.CleanVoltageUpperLimit.value",
    "MeasurementData.MeasurementParameter.CleaningAirBlowActive.value",
    "MeasurementData.MeasurementParameter.CoolingAirActive.value",
    "MeasurementData.MeasurementParameter.WeldToolSlideForwardMoveTime.value",
    "MeasurementData.MeasurementParameter.WeldToolSlideForwardResponseTimeActualLeaveBackPosition.value",
    "MeasurementData.MeasurementParameter.WeldToolSlideForwardSlidePosition.value",
    "MeasurementData.MeasurementParameter.WeldToolSlideBackwardMoveTime.value",
    "MeasurementData.MeasurementParameter.FeedingTimeActual.value",
    "MeasurementData.MeasurementParameter.FeedingTimeStudInTube.value",
    "MeasurementData.MeasurementParameter.WeldToolMoveTimeLoadingPinBackward.value",
    "MeasurementData.MeasurementParameter.WeldToolMoveTimeLoadingPinForward.value",
    "MeasurementData.MeasurementParameter.WeldToolMoveTimeRotationSegmentInPickupPosition.value",
    "MeasurementData.MeasurementParameter.WeldToolGripperValueStudActual.value",
    "MeasurementData.MeasurementParameter.WeldToolGripperCorrectionValue.value",
    "MeasurementData.MeasurementParameter.WeldToolGripperValueOpenActual.value",
    "MeasurementData.MeasurementParameter.WeldToolGripperCloseMoveTimeActual.value",
    "MeasurementData.MeasurementParameter.WeldToolGripperOpenMoveTimeActual.value",
    "MeasurementData.MeasurementParameter.WeldToolPickupRotationAnglePosition.value",
    "MeasurementData.MeasurementParameter.WeldToolStudBlockValueActual.value"
  ],
  "sort": [
    {
      "timestamp": "asc"
    }
  ],
  "size": 100
}

GET _sql/translate
{
  "query": """
SELECT uniqueID, MeasurementData.MeasurementParameter.StudID.value, year(timestamp), month(timestamp), count(*), min(WeldVoltageActual), max(WeldVoltageActual), avg(WeldVoltageActual)
FROM ml_toolbox_raw_data
WHERE uniqueID in ('h902-080tsb101-kf130.m050g9sub63sps2.1.1','h902-080tsb201-kf130.m050g9sub63sps2.1.1') and
      FaultCode = '0' and 
      MeasurementData.MeasurementParameter.StudID.value in ('620168_213_1_2_1_1_1_2', '610836_213_1_2_1_2_1_1')
GROUP BY 1,2,3,4
ORDER BY 1,2,3,4
LIMIT 10
  """
}


GET ml_toolbox_raw_data/_search
{
  "size" : 0,
  "query" : {
    "bool" : {
      "must" : [
        {
          "terms" : {
            "uniqueID.keyword" : [
              "h902-130tsb401-kf130.m050g9sub64sps4.1.1",
              "h902-170tsb101-kf130.m050g9sub64sps5.1.1",
              "h902-110tsb201-kf130.m050g9sub64sps3.2.1",
              "h902-060tsb401-kf130.m050g9sub64sps2.2.1",
              "h902-040tsb201-kf130.m050g9sub64sps1.1.1",
              "h902-110tsb101-kf130.m050g9sub64sps3.1.1",
              "h902-140tsb101-kf130.m050g9sub63sps3.1.1",
              "h902-140tsb301-kf130.m050g9sub63sps3.1.1",
              "h902-130tsb101-kf130.m050g9sub63sps3.1.1",
              "h902-090tsb101-kf130.m050g9sub63sps2.1.1",
              "h902-080tsb201-kf130.m050g9sub63sps2.1.1",
              "h902-080tsb101-kf130.m050g9sub63sps2.1.1",
              "h902-070tsb201-kf130.m050g9sub63sps2.1.1"
            ],
            "boost" : 1.0
          }
        },
        {
          "term" : {
            "FaultCode.keyword" : {
              "value" : "0",
              "boost" : 1.0
            }
          }
        }
      ],
      "adjust_pure_negative" : true,
      "boost" : 1.0
    }
  },
  "_source" : false,
  "stored_fields" : "_none_",
  "aggregations" : {
    "groupby" : {
      "composite" : {
        "size" : 10,
        "sources" : [
          {
            "unique_id_b" : {
              "terms" : {
                "field" : "uniqueID.keyword",
                "missing_bucket" : true,
                "order" : "asc"
              }
            }
          },
          {
            "extension_b" : {
              "terms" : {
                "field" : "MeasurementData.MeasurementParameter.StudID.value.keyword",
                "missing_bucket" : true,
                "order" : "asc"
              }
            }
          },
          {
            "year_b" : {
              "date_histogram" : {
                "field" : "timestamp",
                "missing_bucket" : true,
                "value_type" : "date",
                "order" : "asc",
                "fixed_interval" : "31536000000ms",
                "time_zone" : "Z"
              }
            }
          },
          {
            "month_b" : {
              "terms" : {
                "script" : {
                  "source" : "InternalSqlScriptUtils.dateTimeChrono(InternalSqlScriptUtils.docValue(doc,params.v0), params.v1, params.v2)",
                  "lang" : "painless",
                  "params" : {
                    "v0" : "timestamp",
                    "v1" : "Z",
                    "v2" : "MONTH_OF_YEAR"
                  }
                },
                "missing_bucket" : true,
                "value_type" : "long",
                "order" : "asc"
              }
            }
          }
        ]
      },
      "aggregations" : {
        "voltage_b" : {
          "extended_stats" : {
            "field" : "WeldVoltageActual",
            "sigma" : 2
          }
        },
        "time_b" : {
          "extended_stats" : {
            "field" : "WeldTimeActual",
            "sigma" : 2
          }
        },
        "current_b" : {
          "extended_stats" : {
            "field" : "WeldCurrentActualPositive",
            "sigma" : 2
          }
        },
        "penetration_b" : {
          "extended_stats" : {
            "field" : "LMPenetrationActual",
            "sigma" : 2
          }
        },
        "stickout_b" : {
          "extended_stats" : {
            "field" : "StickoutActual",
            "sigma" : 2
          }
        },
        "drop_time_b" : {
          "extended_stats" : {
            "field" : "DropTimeActual",
            "sigma" : 2
          }
        },
        "lift_b" : {
          "extended_stats" : {
            "field" : "LMLiftHeightActual",
            "sigma" : 2
          }
        },
        "energy_b" : {
          "extended_stats" : {
            "field" : "WeldEnergyActual",
            "sigma" : 2
          }
        }
      }
    }
  }
}


GET _sql/translate
{
  "query": """
SELECT uniqueID, MeasurementData.MeasurementParameter.StudID.value, timestamp,  WeldVoltageActual, WeldTimeActual, WeldCurrentActualPositive, LMPenetrationActual, StickoutActual, DropTimeActual, LMLiftHeightActual, WeldEnergyActual, FaultCode
FROM ml_toolbox_raw_data
WHERE uniqueID in ('h902-080tsb101-kf130.m050g9sub63sps2.1.1','h902-080tsb201-kf130.m050g9sub63sps2.1.1')
LIMIT 10
  """
}


GET ml_toolbox_raw_data/_search
{
  "size" : 1000,
  "query" : {
    "terms" : {
      "uniqueID.keyword" : [
        "h902-130tsb401-kf130.m050g9sub64sps4.1.1",
        "h902-170tsb101-kf130.m050g9sub64sps5.1.1",
        "h902-110tsb201-kf130.m050g9sub64sps3.2.1",
        "h902-060tsb401-kf130.m050g9sub64sps2.2.1",
        "h902-040tsb201-kf130.m050g9sub64sps1.1.1",
        "h902-110tsb101-kf130.m050g9sub64sps3.1.1",
        "h902-140tsb101-kf130.m050g9sub63sps3.1.1",
        "h902-140tsb301-kf130.m050g9sub63sps3.1.1",
        "h902-130tsb101-kf130.m050g9sub63sps3.1.1",
        "h902-090tsb101-kf130.m050g9sub63sps2.1.1",
        "h902-080tsb201-kf130.m050g9sub63sps2.1.1",
        "h902-080tsb101-kf130.m050g9sub63sps2.1.1",
        "h902-070tsb201-kf130.m050g9sub63sps2.1.1"
      ],
      "boost" : 1.0
    }
  },
  "_source" : {
    "includes" : [
      "uniqueID",
      "MeasurementData.MeasurementParameter.StudID.value",
      "WeldVoltageActual",
      "WeldTimeActual",
      "WeldCurrentActualPositive",
      "LMPenetrationActual",
      "StickoutActual",
      "DropTimeActual",
      "LMLiftHeightActual",
      "WeldEnergyActual",
      "FaultCode",
      "timestamp"
    ],
    "excludes" : [ ]
  },
  "docvalue_fields" : [
    {
      "field" : "timestamp",
      "format" : "YYYY-MM-DD HH:mm:ss"
    }
  ],
  "sort" : [
    {
      "_doc" : {
        "order" : "asc"
      }
    }
  ]
}


GET ml_toolbox_raw_data/_search
{
  "size" : 0,
  "query" : {
    "bool" : {
      "must" : [
        {
          "terms" : {
            "uniqueID.keyword" : [
              "h902-130tsb401-kf130.m050g9sub64sps4.1.1",
              "h902-170tsb101-kf130.m050g9sub64sps5.1.1",
              "h902-110tsb201-kf130.m050g9sub64sps3.2.1",
              "h902-060tsb401-kf130.m050g9sub64sps2.2.1",
              "h902-040tsb201-kf130.m050g9sub64sps1.1.1",
              "h902-110tsb101-kf130.m050g9sub64sps3.1.1",
              "h902-140tsb101-kf130.m050g9sub63sps3.1.1",
              "h902-140tsb301-kf130.m050g9sub63sps3.1.1",
              "h902-130tsb101-kf130.m050g9sub63sps3.1.1",
              "h902-090tsb101-kf130.m050g9sub63sps2.1.1",
              "h902-080tsb201-kf130.m050g9sub63sps2.1.1",
              "h902-080tsb101-kf130.m050g9sub63sps2.1.1",
              "h902-070tsb201-kf130.m050g9sub63sps2.1.1"
            ],
            "boost" : 1.0
          }
        },
        {
          "term" : {
            "FaultCode.keyword" : {
              "value" : "0",
              "boost" : 1.0
            }
          }
        }
      ],
      "adjust_pure_negative" : true,
      "boost" : 1.0
    }
  },
  "_source" : false,
  "stored_fields" : "_none_",
  "aggregations" : {
    "groupby" : {
      "composite" : {
        "size" : 10,
        "sources" : [
          {
            "unique_id_b" : {
              "terms" : {
                "field" : "uniqueID.keyword",
                "missing_bucket" : true,
                "order" : "asc"
              }
            }
          },
          {
            "extension_b" : {
              "terms" : {
                "field" : "MeasurementData.MeasurementParameter.StudID.value.keyword",
                "missing_bucket" : true,
                "order" : "asc"
              }
            }
          },
          {
            "period_b" : {
              "date_histogram" : {
                "field" : "timestamp",
                "missing_bucket" : true,
                "calendar_interval": "month",
                "format": "yyyy-MM"
              }
            }
          }
        ]
      },
      "aggregations" : {
        "voltage_b" : {
          "extended_stats" : {
            "field" : "WeldVoltageActual",
            "sigma" : 2
          }
        },
        "time_b" : {
          "extended_stats" : {
            "field" : "WeldTimeActual",
            "sigma" : 2
          }
        },
        "current_b" : {
          "extended_stats" : {
            "field" : "WeldCurrentActualPositive",
            "sigma" : 2
          }
        },
        "penetration_b" : {
          "extended_stats" : {
            "field" : "LMPenetrationActual",
            "sigma" : 2
          }
        },
        "stickout_b" : {
          "extended_stats" : {
            "field" : "StickoutActual",
            "sigma" : 2
          }
        },
        "drop_time_b" : {
          "extended_stats" : {
            "field" : "DropTimeActual",
            "sigma" : 2
          }
        },
        "lift_b" : {
          "extended_stats" : {
            "field" : "LMLiftHeightActual",
            "sigma" : 2
          }
        },
        "energy_b" : {
          "extended_stats" : {
            "field" : "WeldEnergyActual",
            "sigma" : 2
          }
        }
      }
    }
  }
}



GET ml_toolbox_raw_data/_search
{
  "size" : 1000,
  "query" : {
    "terms" : {
      "uniqueID.keyword" : [
        "h902-130tsb401-kf130.m050g9sub64sps4.1.1",
        "h902-170tsb101-kf130.m050g9sub64sps5.1.1",
        "h902-110tsb201-kf130.m050g9sub64sps3.2.1",
        "h902-060tsb401-kf130.m050g9sub64sps2.2.1",
        "h902-040tsb201-kf130.m050g9sub64sps1.1.1",
        "h902-110tsb101-kf130.m050g9sub64sps3.1.1",
        "h902-140tsb101-kf130.m050g9sub63sps3.1.1",
        "h902-140tsb301-kf130.m050g9sub63sps3.1.1",
        "h902-130tsb101-kf130.m050g9sub63sps3.1.1",
        "h902-090tsb101-kf130.m050g9sub63sps2.1.1",
        "h902-080tsb201-kf130.m050g9sub63sps2.1.1",
        "h902-080tsb101-kf130.m050g9sub63sps2.1.1",
        "h902-070tsb201-kf130.m050g9sub63sps2.1.1"
      ],
      "boost" : 1.0
    }
  },
  "_source" : {
    "includes" : [
      "uniqueID",
      "MeasurementData.MeasurementParameter.StudID.value",
      "WeldVoltageActual",
      "WeldTimeActual",
      "WeldCurrentActualPositive",
      "LMPenetrationActual",
      "StickoutActual",
      "DropTimeActual",
      "LMLiftHeightActual",
      "WeldEnergyActual",
      "FaultCode",
      "timestamp"
    ]
  }
}


GET _sql?format=txt
{
  "query": """
SELECT CONCAT(location,
       CONCAT('-',
       CONCAT(series,
       CONCAT('-',
       CONCAT(line,
       CONCAT('-',
       CONCAT(plant,
       CONCAT('-',
       CONCAT(station,
       CONCAT('-',
       CONCAT(robot,
       CONCAT('-',
       CONCAT(controller,
       CONCAT('-',
       CONCAT(tool,
       CONCAT('-', MeasurementData.MeasurementParameter.StudID.value)))))))))))))))) as StudExtension, count(*) as count
FROM ml_toolbox_raw_data
WHERE plant = 'UB64' AND
    location is not NULL AND
    series is not NULL AND
    line is not NULL AND
    station is not NULL AND
    robot is not NULL AND
    controller is not NULL AND
    tool is not NULL AND
    StudID is not NULL AND
    timestamp >= '2020-05-01' AND
    timestamp < '2020-09-01'
GROUP BY 1 having count(*) > 250
  """
}


GET _sql?format=txt
{
  "query": """
SELECT CONCAT(location,
       CONCAT('-',
       CONCAT(series,
       CONCAT('-',
       CONCAT(line,
       CONCAT('-',
       CONCAT(plant,
       CONCAT('-',
       CONCAT(station,
       CONCAT('-',
       CONCAT(robot,
       CONCAT('-',
       CONCAT(controller,
       CONCAT('-',
       CONCAT(tool,
       CONCAT('-', MeasurementData.MeasurementParameter.StudID.value)))))))))))))))) as StudExtension, count(*) as count
FROM ml_toolbox_raw_data
WHERE plant = 'UB63' AND
    location is not NULL AND
    series is not NULL AND
    line is not NULL AND
    station is not NULL AND
    robot is not NULL AND
    controller is not NULL AND
    tool is not NULL AND
    StudID is not NULL AND
    timestamp >= '2020-05-01' AND
    timestamp < '2020-10-01'
GROUP BY 1 having count(*) > 250
  """
}







