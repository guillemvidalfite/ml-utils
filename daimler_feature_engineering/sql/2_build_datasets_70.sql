

-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
--- JOIN FEATURES INTO FINAL DATASETS
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
drop table if exists welds_70_datasets_features;
create table welds_70_datasets_features as
select 
        a.extensionid,
        a."uniqueID",
        a.weld_timestamp,
        a."CarbodyID",
        a."SeriesTypeDescription",
        a."SeriesLRHandDriveDescription",
        a."SeriesVariantDescription",
        a."SeriesModelDescription",
        a."toolType",
        a."studType",
        a."studSize",
        a."WeldToolType",
        a."WeldCurrentActualPositive",
        a."WeldCurrentReferencePositive",
        a."WeldCurrentUpperLimit",
        a."WeldCurrentLowerLimit",
        a."WeldTimeActual",
        a."WeldTimeReference",
        a."WeldTimeUpperLimit",
        a."WeldTimeLowerLimit",
        a."WeldVoltageActual",
        a."WeldVoltageUpperLimit",
        a."WeldVoltageLowerLimit",
        a."WeldVoltagePeakActual",
        a."WeldVoltageDropActual",
        a."WeldEnergyActual",
        a."WeldEnergyUpperLimit",
        a."WeldEnergyLowerLimit",
        a."PilotVoltageActual",
        a."PilotVoltageLowerLimit",
        a."PilotVoltageUpperLimit",
        a."LMLiftHeightActual",
        a."LMLiftHeightReference",
        a."LMLiftHeightUpperLimit",
        a."LMLiftHeightLowerLimit",
        a."LMPenetrationActual",
        a."LMPenetrationReference",
        a."LMPenetrationUpperLimit",
        a."LMPenetrationLowerLimit",
        a."DropTimeActual",
        a."DropTimeReference",
        a."StickoutActual",
        a."CleanTimeActual",
        a."fingerprint",
        a."FeederNo",
        a."OutletNo",
        a."ToolNo",
        a."WIP",
        a."FaultCode",
        a."mqtt.topic.element.typ",
        a."mqtt.topic.element.typ_version",
        a."MMP.Devicetype",
        a."MMP.InternalStudID",
        a."MMP.SystemTotalWelds",
        a."MMP.OutletTotalWelds",
        a."MMP.OutletTotalWOPs",
        a."MMP.WeldToolTotalWelds",
        a."MMP.ProgTotalWelds",
        a."MMP.StudReloadCountMissingStud",
        a."MMP.StudReloadCountNoSOW",
        a."MMP.WeldProcess",
        a."MMP.PilotCurrentActual",
        a."MMP.PilotTimeActual",
        a."MMP.WeldVoltagePeakReference",
        a."MMP.WeldVoltageDropReference",
        a."MMP.WeldCurrentReferenceNegative",
        a."MMP.WeldCurrentActualNegative",
        a."MMP.LMPositionActual",
        a."MMP.LiftFinishedMode",
        a."MMP.StickoutReference",
        a."MMP.StickoutLowerLimit",
        a."MMP.StickoutUpperLimit",
        a."MMP.TRRotationAngleActual",
        a."MMP.ProtectiveGasPreFlowActive",
        a."MMP.ProtectiveGasFlowDuringWeldprocessActive",
        a."MMP.ProtectiveGasPostFlowActive",
        a."MMP.CleanCurrentActual",
        a."MMP.CleanSuccessful",
        a."MMP.CleanVoltageActual",
        a."MMP.CleanVoltageLowerLimit",
        a."MMP.CleanVoltageUpperLimit",
        a."MMP.CleaningAirBlowActive",
        a."MMP.CoolingAirActive",
        a."MMP.WTSForwardMoveTime",
        a."MMP.WTSForwardResponseTimeActualLeaveBackPosition",
        a."MMP.WTSForwardSlidePosition",
        a."MMP.WTSBackwardMoveTime",
        a."MMP.FeedingTimeActual",
        a."MMP.FeedingTimeStudInTube",
        a."MMP.WeldToolMoveTimeLoadingPinBackward",
        a."MMP.WeldToolMoveTimeLoadingPinForward",
        a."MMP.WeldToolMoveTimeRotationSegmentInPickupPosition",
        a."MMP.WeldToolGripperValueStudActual",
        a."MMP.WeldToolGripperCorrectionValue",
        a."MMP.WeldToolGripperValueOpenActual",
        a."MMP.WeldToolGripperCloseMoveTimeActual",
        a."MMP.WeldToolGripperOpenMoveTimeActual",
        a."MMP.WeldToolPickupRotationAnglePosition",
        a."MMP.WeldToolStudBlockValueActual",
        a."Voltage.FFT_1_LOC",
        a."Voltage.FFT_1_VALUE",
        a."Voltage.FFT_2_LOC",
        a."Voltage.FFT_2_VALUE",
        a."Voltage.FFT_3_LOC",
        a."Voltage.FFT_3_VALUE",
        a."Voltage.PSD_1_LOC",
        a."Voltage.PSD_1_VALUE",
        a."Voltage.PSD_2_LOC",
        a."Voltage.PSD_2_VALUE",
        a."Voltage.PSD_3_LOC",
        a."Voltage.PSD_3_VALUE",
        a."Voltage.ACF_Entropy",
        a."Voltage.ACF_ZeroCrossings",
        a."Voltage.ACF_MeanCrossings",
        a."Voltage.ACF_Quantile5",
        a."Voltage.ACF_Quantile25",
        a."Voltage.ACF_Quantile75",
        a."Voltage.ACF_Quantile95",
        a."Voltage.ACF_Median",
        a."Voltage.ACF_Mean",
        a."Voltage.ACF_StdDeviation",
        a."Voltage.ACF_Variance",
        a."Voltage.ACF_RMS",
        a."Voltage.PACF_Entropy",
        a."Voltage.PACF_ZeroCrossings",
        a."Voltage.PACF_MeanCrossings",
        a."Voltage.PACF_Quantile5",
        a."Voltage.PACF_Quantile25",
        a."Voltage.PACF_Quantile75",
        a."Voltage.PACF_Quantile95",
        a."Voltage.PACF_Median",
        a."Voltage.PACF_Mean",
        a."Voltage.PACF_StdDeviation",
        a."Voltage.PACF_Variance",
        a."Voltage.PACF_RMS",
        a."Voltage.CWT_1_TIME",
        a."Voltage.CWT_1_FREQ",
        a."Voltage.CWT_1_VALUE",
        a."Voltage.CWT_2_TIME",
        a."Voltage.CWT_2_FREQ",
        a."Voltage.CWT_2_VALUE",
        a."Voltage.CWT_3_TIME",
        a."Voltage.CWT_3_FREQ",
        a."Voltage.CWT_3_VALUE",
        a."Voltage.DTW_Distance",
        a."Current.FFT_1_LOC",
        a."Current.FFT_1_VALUE",
        a."Current.FFT_2_LOC",
        a."Current.FFT_2_VALUE",
        a."Current.FFT_3_LOC",
        a."Current.FFT_3_VALUE",
        a."Current.PSD_1_LOC",
        a."Current.PSD_1_VALUE",
        a."Current.PSD_2_LOC",
        a."Current.PSD_2_VALUE",
        a."Current.PSD_3_LOC",
        a."Current.PSD_3_VALUE",
        a."Current.ACF_Entropy",
        a."Current.ACF_ZeroCrossings",
        a."Current.ACF_MeanCrossings",
        a."Current.ACF_Quantile5",
        a."Current.ACF_Quantile25",
        a."Current.ACF_Quantile75",
        a."Current.ACF_Quantile95",
        a."Current.ACF_Median",
        a."Current.ACF_Mean",
        a."Current.ACF_StdDeviation",
        a."Current.ACF_Variance",
        a."Current.ACF_RMS",
        a."Current.PACF_Entropy",
        a."Current.PACF_ZeroCrossings",
        a."Current.PACF_MeanCrossings",
        a."Current.PACF_Quantile5",
        a."Current.PACF_Quantile25",
        a."Current.PACF_Quantile75",
        a."Current.PACF_Quantile95",
        a."Current.PACF_Median",
        a."Current.PACF_Mean",
        a."Current.PACF_StdDeviation",
        a."Current.PACF_Variance",
        a."Current.PACF_RMS",
        a."Current.CWT_1_TIME",
        a."Current.CWT_1_FREQ",
        a."Current.CWT_1_VALUE",
        a."Current.CWT_2_TIME",
        a."Current.CWT_2_FREQ",
        a."Current.CWT_2_VALUE",
        a."Current.CWT_3_TIME",
        a."Current.CWT_3_FREQ",
        a."Current.CWT_3_VALUE",
        a."Current.DTW_Distance",
        a."LiftPosition.FFT_1_LOC",
        a."LiftPosition.FFT_1_VALUE",
        a."LiftPosition.FFT_2_LOC",
        a."LiftPosition.FFT_2_VALUE",
        a."LiftPosition.FFT_3_LOC",
        a."LiftPosition.FFT_3_VALUE",
        a."LiftPosition.PSD_1_LOC",
        a."LiftPosition.PSD_1_VALUE",
        a."LiftPosition.PSD_2_LOC",
        a."LiftPosition.PSD_2_VALUE",
        a."LiftPosition.PSD_3_LOC",
        a."LiftPosition.PSD_3_VALUE",
        a."LiftPosition.ACF_Entropy",
        a."LiftPosition.ACF_ZeroCrossings",
        a."LiftPosition.ACF_MeanCrossings",
        a."LiftPosition.ACF_Quantile5",
        a."LiftPosition.ACF_Quantile25",
        a."LiftPosition.ACF_Quantile75",
        a."LiftPosition.ACF_Quantile95",
        a."LiftPosition.ACF_Median",
        a."LiftPosition.ACF_Mean",
        a."LiftPosition.ACF_StdDeviation",
        a."LiftPosition.ACF_Variance",
        a."LiftPosition.ACF_RMS",
        a."LiftPosition.PACF_Entropy",
        a."LiftPosition.PACF_ZeroCrossings",
        a."LiftPosition.PACF_MeanCrossings",
        a."LiftPosition.PACF_Quantile5",
        a."LiftPosition.PACF_Quantile25",
        a."LiftPosition.PACF_Quantile75",
        a."LiftPosition.PACF_Quantile95",
        a."LiftPosition.PACF_Median",
        a."LiftPosition.PACF_Mean",
        a."LiftPosition.PACF_StdDeviation",
        a."LiftPosition.PACF_Variance",
        a."LiftPosition.PACF_RMS",
        a."LiftPosition.CWT_1_TIME",
        a."LiftPosition.CWT_1_FREQ",
        a."LiftPosition.CWT_1_VALUE",
        a."LiftPosition.CWT_2_TIME",
        a."LiftPosition.CWT_2_FREQ",
        a."LiftPosition.CWT_2_VALUE",
        a."LiftPosition.CWT_3_TIME",
        a."LiftPosition.CWT_3_FREQ",
        a."LiftPosition.CWT_3_VALUE",
        a."LiftPosition.DTW_Distance",
        a."LMCurrent.FFT_1_LOC",
        a."LMCurrent.FFT_1_VALUE",
        a."LMCurrent.FFT_2_LOC",
        a."LMCurrent.FFT_2_VALUE",
        a."LMCurrent.FFT_3_LOC",
        a."LMCurrent.FFT_3_VALUE",
        a."LMCurrent.PSD_1_LOC",
        a."LMCurrent.PSD_1_VALUE",
        a."LMCurrent.PSD_2_LOC",
        a."LMCurrent.PSD_2_VALUE",
        a."LMCurrent.PSD_3_LOC",
        a."LMCurrent.PSD_3_VALUE",
        a."LMCurrent.ACF_Entropy",
        a."LMCurrent.ACF_ZeroCrossings",
        a."LMCurrent.ACF_MeanCrossings",
        a."LMCurrent.ACF_Quantile5",
        a."LMCurrent.ACF_Quantile25",
        a."LMCurrent.ACF_Quantile75",
        a."LMCurrent.ACF_Quantile95",
        a."LMCurrent.ACF_Median",
        a."LMCurrent.ACF_Mean",
        a."LMCurrent.ACF_StdDeviation",
        a."LMCurrent.ACF_Variance",
        a."LMCurrent.ACF_RMS",
        a."LMCurrent.PACF_Entropy",
        a."LMCurrent.PACF_ZeroCrossings",
        a."LMCurrent.PACF_MeanCrossings",
        a."LMCurrent.PACF_Quantile5",
        a."LMCurrent.PACF_Quantile25",
        a."LMCurrent.PACF_Quantile75",
        a."LMCurrent.PACF_Quantile95",
        a."LMCurrent.PACF_Median",
        a."LMCurrent.PACF_Mean",
        a."LMCurrent.PACF_StdDeviation",
        a."LMCurrent.PACF_Variance",
        a."LMCurrent.PACF_RMS",
        a."LMCurrent.CWT_1_TIME",
        a."LMCurrent.CWT_1_FREQ",
        a."LMCurrent.CWT_1_VALUE",
        a."LMCurrent.CWT_2_TIME",
        a."LMCurrent.CWT_2_FREQ",
        a."LMCurrent.CWT_2_VALUE",
        a."LMCurrent.CWT_3_TIME",
        a."LMCurrent.CWT_3_FREQ",
        a."LMCurrent.CWT_3_VALUE",
        a."LMCurrent.DTW_Distance",
        b.penetration_avg_distance,
        b.penetration_offsigma_distance,
        b.energy_avg_distance,
        b.energy_offsigma_distance,
        b.drop_time_avg_distance,
        b.drop_time_offsigma_distance,
        b.stickout_avg_distance,
        b.stickout_offsigma_distance,
        b.lift_avg_distance,
        b.lift_offsigma_distance,
        b.time_avg_distance,
        b.time_offsigma_distance,
        b.current_avg_distance,
        b.current_offsigma_distance,
        b.voltage_avg_distance,
        b.voltage_offsigma_distance,
        a.bodyshop_repair,
        a.assembly_repair,
        a.error
from welds_70_datasets a
     left join welds_70_current_stats b on a.fingerprint = b.fingerprint
where extensionid not in
('610504_213_3_1_1_2_1_1','610641_213_1_1_1_1_1_1','610761_213_1_1_1_1_1_1','610811_213_1_1_1_2_1_1','610997_213_3_1_1_2_1_1','611022_213_1_1_1_1_1_1',
'611046_213_3_1_1_2_1_1','611048_213_1_1_1_2_1_1','620406_213_1_1_1_1_1_1','620406_213_3_1_1_2_1_1','620418_213_1_2_1_1_1_1','620448_213_1_1_1_1_1_1',
'620478_213_1_2_1_2_1_1','620488_213_1_1_1_2_1_1','620691_213_1_2_1_1_1_1','620774_213_1_1_1_2_1_1','620774_213_3_1_1_2_1_1','620776_213_1_1_1_1_1_1',
'620788_213_1_2_1_2_1_1');
-- reject extensions without data

